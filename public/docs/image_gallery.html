<!DOCTYPE html>  <html> <head>   <title>image_gallery.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               image_gallery.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>An amazingly handy remove function created by John Resig of jQuery.
TODO: Move this into a more global "useful things" script.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">remove</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Array Remove - By John Resig (MIT Licensed)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">rest</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">slice</span><span class="p">((</span><span class="nx">to</span> <span class="o">||</span> <span class="nx">from</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">from</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">from</span> <span class="o">:</span> <span class="nx">from</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">rest</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">move</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">move</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">to</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="p">};</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Allows us to use partials with precompiled templates.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span><span class="p">(</span><span class="s1">&#39;partial&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">templateName</span><span class="p">,</span><span class="nx">context</span><span class="p">){</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="nx">Handlebars</span><span class="p">.</span><span class="nx">templates</span><span class="p">[</span><span class="nx">templateName</span><span class="p">](</span><span class="k">this</span><span class="p">));</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">isObjectEmpty</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">isEmpty</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">for</span><span class="p">(</span><span class="nx">keys</span> <span class="k">in</span> <span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">isEmpty</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
         <span class="k">break</span><span class="p">;</span> <span class="c1">// exiting since we found that the object is not empty</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">isEmpty</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Namespace</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">IG</span> <span class="o">=</span> <span class="nx">IG</span> <span class="o">||</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Model - things that get and sort datas.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">Model</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">errorCodes</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">images</span><span class="o">:</span> <span class="p">{</span>
            <span class="mi">1</span><span class="o">:</span> <span class="s1">&#39;No name entered. You have to give your images a unique name.&#39;</span><span class="p">,</span>
            <span class="mi">2</span><span class="o">:</span> <span class="s1">&#39;That name is already taken, try another unique name.&#39;</span><span class="p">,</span>
            <span class="mi">3</span><span class="o">:</span> <span class="s1">&#39;Your image must have a URL.&#39;</span>
        <span class="p">},</span>
        <span class="nx">galleries</span><span class="o">:</span> <span class="p">{</span>
            <span class="mi">1</span><span class="o">:</span> <span class="s1">&#39;No name entered. You have to give your galleries a unique name.&#39;</span><span class="p">,</span>
            <span class="mi">2</span><span class="o">:</span> <span class="s1">&#39;That name is already taken, try another unique name.&#39;</span><span class="p">,</span>
            <span class="mi">3</span><span class="o">:</span> <span class="s1">&#39;The image width has to be a valid number.&#39;</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">defaultOptions</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">galleries</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;showDetails&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="s2">&quot;thumbSize&quot;</span><span class="o">:</span> <span class="s2">&quot;200px&quot;</span><span class="p">,</span>
            <span class="s2">&quot;constrWidth&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="s2">&quot;showGrDescr&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="s2">&quot;showImgNames&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="s2">&quot;showImgDescr&quot;</span><span class="o">:</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>parses the objects in the models
back into the JSON format that Cookie expects to see.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">jsonToString</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dataArray</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">outputString</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;imageGroups&quot;</span><span class="o">:</span> <span class="p">[]},</span>
            <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">grMax</span> <span class="o">=</span> <span class="nx">dataArray</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
            <span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">imgMax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">grMax</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">outputString</span><span class="p">.</span><span class="nx">imageGroups</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="nx">dataArray</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="nx">dataArray</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">description</span><span class="p">,</span>
                <span class="s2">&quot;images&quot;</span><span class="o">:</span> <span class="p">[],</span>
                <span class="s2">&quot;options&quot;</span><span class="o">:</span> <span class="nx">dataArray</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">options</span>
            <span class="p">};</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">dataArray</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">images</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">imgMax</span> <span class="o">=</span> <span class="nx">dataArray</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">images</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="nx">imgMax</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">outputString</span><span class="p">.</span><span class="nx">imageGroups</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">images</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="nx">dataArray</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">images</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">name</span><span class="p">,</span>
                        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="nx">dataArray</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">images</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">description</span><span class="p">,</span>
                        <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="nx">dataArray</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">images</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">url</span>
                    <span class="p">};</span>
                <span class="p">};</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">outputString</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Takes the string value of the data sent from Cookie
and parses it into something the IG app can use.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">stringToJSON</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataString</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">parseJSON</span><span class="p">(</span><span class="nx">dataString</span><span class="p">);</span>
    <span class="p">}</span>



<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h1>Actors</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2>ImageGallery</h2>

<p>Connects the Data to the ImageGallery Input Node
which is required to save and retrieve form data.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGallery</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">settings</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">inputNode</span><span class="p">,</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parentContainer</span><span class="p">,</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">imageGroups</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;datachange&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">updateInputNode</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>

    <span class="kd">function</span> <span class="nx">init</span><span class="p">(</span><span class="nx">settings</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">galleryData</span> <span class="o">=</span> <span class="p">{},</span> 
            <span class="nx">newGroupSettings</span><span class="p">,</span> <span class="nx">newImageSettings</span><span class="p">,</span>
            <span class="nx">newImage</span><span class="p">,</span> <span class="nx">newGroup</span><span class="p">,</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Strong type checking of settings values.
We can't continue without the parentContainer and the inputNode.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">inputNode</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">inputNode</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">inputNode</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">inputNode</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;no inputNode set. This must be a STRING, not a jQuery object (&#39;.myNode&#39; not $(&#39;.myNode&#39;).)&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">parentContainer</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">parentContainer</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">parentContainer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">parentContainer</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;no parentContainer set. This must be a STRING, not a jQuery object (&#39;.myNode&#39; not $(&#39;.myNode&#39;).)&quot;</span><span class="p">);</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>on init, parse up the data that's already available and
generate our views with the known Gallery Objects.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">data</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">data</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">isObjectEmpty</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">galleryData</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">imageGroups</span><span class="p">;</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">galleryData</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">newGroupSettings</span> <span class="o">=</span> <span class="nx">galleryData</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

                <span class="nx">newGroup</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">createImageGroup</span><span class="p">(</span><span class="nx">newGroupSettings</span><span class="p">,</span> <span class="s2">&quot;push&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>if there's images inside, create them too.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">galleryData</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">images</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">for</span> <span class="p">(</span><span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="nx">galleryData</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">images</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">newImageSettings</span> <span class="o">=</span> <span class="nx">galleryData</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">images</span><span class="p">[</span><span class="nx">n</span><span class="p">];</span>
                        <span class="nx">newImage</span> <span class="o">=</span> <span class="nx">newGroup</span><span class="p">.</span><span class="nx">createImage</span><span class="p">(</span><span class="nx">newImageSettings</span><span class="p">,</span> <span class="s2">&quot;push&quot;</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="nx">$</span><span class="p">(</span><span class="nx">self</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;datachange&#39;</span><span class="p">);</span>

            <span class="p">}</span>


        <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>fire in zee hole!</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">init</span><span class="p">(</span><span class="nx">settings</span><span class="p">);</span>

<span class="p">};</span>
    
<span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGallery</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getImageGroups</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">imageGroups</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h3>updateInputNode</h3>

<p>takes the currently stored JSON object,
and pushes it back to the Form InputNode.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGallery</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updateInputNode</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">imageGroups</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">inputNode</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">IG</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">jsonToString</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span> 
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;updateview&#39;</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h3>createImageGroup</h3>

<p>creates new groups based on the passed settings.
Must have at least a unique name value.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGallery</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">createImageGroup</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">settings</span><span class="p">,</span> <span class="nx">order</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">currentGroups</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getImageGroups</span><span class="p">(),</span>
        <span class="nx">imageGroupObject</span><span class="p">,</span> <span class="nx">groupSettings</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">defaultSettings</span> <span class="o">=</span> <span class="nx">IG</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">defaultOptions</span><span class="p">.</span><span class="nx">galleries</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">settings</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span> <span class="s2">&quot;error&quot;</span><span class="o">:</span> <span class="mi">1</span> <span class="p">};</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>check if this group we're adding is already in there.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">imageGroupObject</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">grep</span><span class="p">(</span><span class="nx">currentGroups</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">currentGroups</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">val</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">imageGroupObject</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>if it exists, return the error that tells the user so.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">return</span> <span class="p">{</span> <span class="s2">&quot;error&quot;</span><span class="o">:</span> <span class="mi">2</span> <span class="p">};</span>

        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">imageGroupObject</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>if options is an empty object, pull everything from defaults.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">settings</span><span class="p">.</span><span class="nx">options</span> <span class="o">||</span> <span class="nx">isObjectEmpty</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">options</span><span class="p">)</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">groupSettings</span> <span class="o">=</span> <span class="nx">defaultSettings</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>load up the settings, if any value is missing pull
from the defaultSettings object.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">for</span> <span class="p">(</span><span class="nx">setting</span> <span class="k">in</span> <span class="nx">defaultSettings</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">setting</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">groupSettings</span><span class="p">[</span><span class="nx">setting</span><span class="p">]</span> <span class="o">=</span> <span class="nx">defaultSettings</span><span class="p">[</span><span class="nx">setting</span><span class="p">]</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">groupSettings</span><span class="p">[</span><span class="nx">setting</span><span class="p">]</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">setting</span><span class="p">];</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>


            <span class="kd">var</span> <span class="nx">newGroup</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGroup</span><span class="p">({</span>
                <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">description</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s2">&quot;options&quot;</span><span class="o">:</span> <span class="nx">groupSettings</span>
            <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>add an index number to the groupObject. It is simply used
to create another unique identifier.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">newGroup</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">currentGroups</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>bind save trigger to newGroup</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">$</span><span class="p">(</span><span class="nx">newGroup</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;datachange&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">updateInputNode</span><span class="p">,</span> <span class="nx">self</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>add the new group to the master list.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">order</span> <span class="o">===</span> <span class="s2">&quot;push&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">imageGroups</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">newGroup</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">imageGroups</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">newGroup</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">$</span><span class="p">(</span><span class="nx">self</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;datachange&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>return the newGroup so we can do more stuff to it,
such as add images.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="nx">newGroup</span><span class="p">;</span>

    <span class="p">}</span> 
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h3>ImageGallery: deleteImageGroup</h3>

<p>Will not delete the only image group in the array. Must have at least 1.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGallery</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">deleteImageGroup</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">groupObject</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">imageGroups</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getImageGroups</span><span class="p">(),</span>
            <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">max</span> <span class="o">=</span> <span class="nx">imageGroups</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>check if the group we want is actually in there.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">max</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>if we find it, kill it!</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">groupObject</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">imageGroups</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">this</span><span class="p">.</span><span class="nx">imageGroups</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
                  <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;datachange&#39;</span><span class="p">);</span>
                  <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGallery</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">editImageGroup</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">groupObject</span><span class="p">,</span> <span class="nx">option</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">groupNameNode</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">option</span> <span class="o">===</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">groupNameNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getImageGroupByName</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">groupNameNode</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">}</span>
        <span class="p">}</span> 
    <span class="p">}</span> 

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">option</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">setting</span> <span class="k">in</span> <span class="nx">option</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">groupObject</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">setting</span><span class="p">]</span> <span class="o">=</span> <span class="nx">option</span><span class="p">[</span><span class="nx">setting</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">groupObject</span><span class="p">[</span><span class="nx">option</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;datachange&#39;</span><span class="p">);</span>
    </pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>return the modified object for further use.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">groupObject</span><span class="p">;</span> 

<span class="p">};</span>

<span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGallery</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getImageGroupByName</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">groupName</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">max</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">imageGroups</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">result</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">imageGroups</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getImageGroups</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>check if the image we want is actually in there.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>if we find it, edit it with new values</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">groupName</span> <span class="o">===</span> <span class="nx">imageGroups</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>return the modified object for further use.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">result</span> <span class="o">=</span> <span class="nx">imageGroups</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="p">}</span>
        
    <span class="p">}</span> 

    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <h2>ImageGallery: findImage</h2>

<p>locates an image Node based on the image name string and group name string.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGallery</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">findImage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">imageName</span><span class="p">,</span> <span class="nx">groupName</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">targetGroup</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getImageGroupByName</span><span class="p">(</span><span class="nx">groupName</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">targetGroup</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">targetGroup</span><span class="p">.</span><span class="nx">getImageByName</span><span class="p">(</span><span class="nx">imageName</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <h3>ImageGallery: moveGroup</h3>

<p>Used to re-order groups in the array.
the array order is also the group display order.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGallery</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">moveGroup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fromName</span><span class="p">,</span> <span class="nx">toName</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">currentGroups</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getImageGroups</span><span class="p">(),</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">max</span> <span class="o">=</span> <span class="nx">currentGroups</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
        <span class="nx">fromIndex</span><span class="p">,</span> <span class="nx">toIndex</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">currentGroups</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span> <span class="o">==</span> <span class="nx">fromName</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">fromIndex</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">currentGroups</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span> <span class="o">==</span> <span class="nx">toName</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">toIndex</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">fromIndex</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">toIndex</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">imageGroups</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="nx">fromIndex</span><span class="p">,</span> <span class="nx">toIndex</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;datachange&#39;</span><span class="p">);</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>--------------------------------- //</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <h2>ImageGroup</h2>

<p>The collection of images.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGroup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">settings</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">description</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">images</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <h3>ImageGroup: createImage</h3>

<p>Creates an instance of the IG.Image class and adds it to the ImageGroup.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGroup</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">createImage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">settings</span><span class="p">,</span> <span class="nx">order</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">newImage</span><span class="p">,</span> <span class="nx">existingImages</span> <span class="o">=</span> <span class="p">[],</span> 
        <span class="nx">newImageIndex</span><span class="p">,</span>
        <span class="nx">imageSettings</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span> <span class="s2">&quot;error&quot;</span><span class="o">:</span> <span class="mi">1</span> <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">settings</span><span class="p">.</span><span class="nx">url</span> <span class="o">||</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">url</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span> <span class="s2">&quot;error&quot;</span><span class="o">:</span> <span class="mi">3</span> <span class="p">};</span>
    <span class="p">}</span> </pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>if the image name already exists in this gallery, find it.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">existingImages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getImageByName</span><span class="p">(</span><span class="nx">imageSettings</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">existingImages</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>if it exists, return the error that tells the user so.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="p">{</span> <span class="s2">&quot;error&quot;</span><span class="o">:</span> <span class="mi">2</span> <span class="p">};</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>we're in the clear, hooray!</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">newImage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IG</span><span class="p">.</span><span class="nx">Image</span><span class="p">(</span><span class="nx">imageSettings</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">order</span> <span class="o">===</span> <span class="s2">&quot;push&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">images</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">newImage</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">images</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">newImage</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;datachange&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">newImage</span><span class="p">;</span>
    <span class="p">}</span>
    

<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <h3>ImageGroup: deleteImage</h3>

<p>Removes an image from the Group.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGroup</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">deleteImage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">imageObject</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">images</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getImages</span><span class="p">(),</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">max</span> <span class="o">=</span> <span class="nx">images</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>check if the image we want is actually in there.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>if we find it, kill it!</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">imageObject</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">images</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">images</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;datachange&#39;</span><span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <h3>ImageGroup: editImage</h3>

<p>Updates an Image Object's settings within this group.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGroup</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">editImage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">imageObject</span><span class="p">,</span> <span class="nx">settings</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">max</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">images</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">images</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">imageObject</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">attribute</span> <span class="k">in</span> <span class="nx">settings</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">images</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">[</span><span class="nx">attribute</span><span class="p">];</span>
            <span class="p">}</span>

            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;datachange&#39;</span><span class="p">);</span>
        <span class="p">}</span>    
    <span class="p">}</span>

<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <h3>ImageGroup: getImages</h3>

<p>Returns the array of Image Objects within this group.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGroup</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getImages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">images</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <h3>ImageGroup: getImageByName</h3>

<p>Returns an Image Object by passing in the name string.
or returns false if none is found.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGroup</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getImageByName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">imageName</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> 
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
        <span class="nx">max</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">images</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">imageName</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">images</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">images</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <h3>ImageGroup: moveImage</h3>

<p>Used to re-order images in the array.
the array order is also the image display order.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGroup</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">moveImage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fromName</span><span class="p">,</span> <span class="nx">toName</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">currentImages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getImages</span><span class="p">(),</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">max</span> <span class="o">=</span> <span class="nx">currentImages</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
        <span class="nx">fromIndex</span><span class="p">,</span> <span class="nx">toIndex</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">currentImages</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span> <span class="o">==</span> <span class="nx">fromName</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">fromIndex</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">currentImages</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span> <span class="o">==</span> <span class="nx">toName</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">toIndex</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">fromIndex</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">toIndex</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">images</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="nx">fromIndex</span><span class="p">,</span> <span class="nx">toIndex</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;datachange&#39;</span><span class="p">);</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <h3>ImageGroup: resort Images</h3>

<p>Takes an array of Images names, re-sorts the image Objects
based on the order of the names.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGroup</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">resortImages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">imageNameArray</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">imageNode</span><span class="p">,</span>
        <span class="nx">currentImages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getImages</span><span class="p">(),</span>
        <span class="nx">newImageArray</span> <span class="o">=</span><span class="p">[];</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">imageNameArray</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">imageNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getImageByName</span><span class="p">(</span><span class="nx">imageNameArray</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">imageNode</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">newImageArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">imageNode</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>we've accounted for all the images and all imageNames
returned a valid object, replace the new array with the old one.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">currentImages</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="nx">newImageArray</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">images</span> <span class="o">=</span> <span class="nx">newImageArray</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;datachange&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>/ ------------------------------ //</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <h2>IG_Image</h2>

<p>The individual Images.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">Image</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">settings</span><span class="p">,</span> <span class="nx">groupName</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">settings</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">settings</span><span class="p">.</span><span class="nx">url</span> <span class="o">||</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">url</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span><span class="p">){</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">groupName</span> <span class="o">||</span> <span class="nx">groupName</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span><span class="p">){</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">groupName</span> <span class="o">=</span> <span class="nx">groupName</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">description</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <h1>VIEW CONTROLLERS</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parentContainer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">parentContainer</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">imageGroup</span> <span class="o">=</span> <span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGroupView</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">image</span> <span class="o">=</span> <span class="nx">IG</span><span class="p">.</span><span class="nx">ImageView</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span> <span class="o">=</span> <span class="nx">model</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">resources</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">renderAll</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bindEvents</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bindEffects</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>init triggers that the views will fire here.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;hidemodal&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">hideModal</span><span class="p">,</span> <span class="nx">self</span><span class="p">));</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;updateview&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">updateView</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <h3>GalleryController: updateView</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updateView</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#imageGalleryWidget&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.images&#39;</span><span class="p">).</span><span class="nx">sortable</span><span class="p">(</span><span class="s2">&quot;destroy&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>make sure the parent is empty.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">parentContainer</span><span class="p">.</span><span class="nx">empty</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">renderAll</span><span class="p">();</span>

<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <h3>GalleryController: renderAll</h3>

<p>Renders the view for all image groups and their images.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">renderAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">imageGroups</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">getImageGroups</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>create the modal container if there isn't one.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editModal&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">prepend</span><span class="p">(</span><span class="s1">&#39;&lt;div id=&quot;editModal&quot; class=&quot;modal fade&quot; /&gt;&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">imageGroups</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">newGroupView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">self</span><span class="p">.</span><span class="nx">imageGroup</span><span class="p">(),</span>
            <span class="nx">groupName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
            <span class="nx">groupImages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getImages</span><span class="p">(),</span>
            <span class="nx">newGroupNode</span><span class="p">,</span> <span class="nx">imagesBlock</span><span class="p">;</span>

        <span class="nx">self</span><span class="p">.</span><span class="nx">parentContainer</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">newGroupView</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
        <span class="nx">newGroupNode</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">parentContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.imageGroup[name=&quot;&#39;</span><span class="o">+</span><span class="nx">groupName</span><span class="o">+</span><span class="s1">&#39;&quot;]&#39;</span><span class="p">);</span>
        <span class="nx">imagesBlock</span> <span class="o">=</span> <span class="nx">newGroupNode</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.images&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>load the images into the template.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">groupImages</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">newImageView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">self</span><span class="p">.</span><span class="nx">image</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">groupName</span> <span class="o">=</span> <span class="nx">groupName</span><span class="p">;</span>

            <span class="nx">imagesBlock</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">newImageView</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
        <span class="p">});</span>
        
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>jQuery UI Sortable on Images. Has to be called every render.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#imageGalleryWidget&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.images&#39;</span><span class="p">).</span><span class="nx">sortable</span><span class="p">({</span>
        <span class="nx">placeholder</span><span class="o">:</span> <span class="s1">&#39;imageGhost&#39;</span><span class="p">,</span>
        <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">){</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">processImageOrder</span><span class="p">(</span><span class="nx">ui</span><span class="p">.</span><span class="nx">item</span><span class="p">);</span>

        <span class="p">}</span>
    <span class="p">});</span>


<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <h3>GalleryController: bindEffects</h3>

<p>Non-essential bindings that make the UI look nicer.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bindEffects</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.image&#39;</span><span class="p">,</span> <span class="s1">&#39;hover&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.buttons, .imgDetails&#39;</span><span class="p">).</span><span class="nx">fadeToggle</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">);</span>
    <span class="p">});</span>

<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <h3>GalleryController: loadAvailableImages</h3>

<p>Makes a call to the server and loads up the first page of available resources
And stores it in the controller for template reference.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAvailableResources</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Restful call: /admin/resources/all.json
just images: /admin/resources/image.json
page: /admin/resources/image/1.json</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">getUrl</span> <span class="o">=</span> <span class="s1">&#39;/admin/resources/image/&#39;</span><span class="o">+</span> <span class="nx">page</span> <span class="o">+</span><span class="s1">&#39;.json&#39;</span><span class="p">;</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span> <span class="nx">getUrl</span><span class="p">,</span>
        <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">resources</span><span class="p">[</span><span class="nx">data</span><span class="p">.</span><span class="nx">page</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">callback</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>

<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <h3>GalleryController: createResourceSettings</h3>

<p>Parses the data returned from getAvailableResources
and makes it usable in the template partial "resourceSelector.tmpl" 
for the new Image Modal.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">createResourceSettings</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">resourceData</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">resourceData</span> <span class="o">=</span> <span class="nx">resourceData</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">resources</span><span class="p">,</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
        <span class="nx">resGroup</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">settings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">availPages</span><span class="o">:</span> <span class="nx">resourceData</span><span class="p">.</span><span class="nx">pages</span><span class="p">,</span>
            <span class="nx">currentPage</span><span class="o">:</span> <span class="nx">resourceData</span><span class="p">.</span><span class="nx">page</span><span class="p">,</span>
            <span class="nx">resImages</span><span class="o">:</span> <span class="p">[],</span>
            <span class="nx">firstPage</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">lastPage</span><span class="o">:</span> <span class="kc">false</span>
        <span class="p">};</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">currentPage</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">settings</span><span class="p">.</span><span class="nx">firstPage</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">currentPage</span> <span class="o">===</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">availPages</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">settings</span><span class="p">.</span><span class="nx">lastPage</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">availPages</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">settings</span><span class="p">.</span><span class="nx">pages</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">settings</span><span class="p">.</span><span class="nx">resImages</span> <span class="o">=</span> <span class="nx">resourceData</span><span class="p">.</span><span class="nx">resources</span><span class="p">;</span>

        <span class="k">return</span> <span class="nx">settings</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">resourcePagination</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pageNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">listWidth</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.resourceList&quot;</span><span class="p">).</span><span class="nx">width</span><span class="p">(),</span>
        <span class="nx">wrapperDiv</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.resourceList .wrapper&quot;</span><span class="p">),</span>
        <span class="nx">rowNode</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.resourceList .row&quot;</span><span class="p">),</span>
        <span class="nx">paginator</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.paginator&#39;</span><span class="p">),</span>
        <span class="nx">currentRowNode</span> <span class="o">=</span> <span class="nx">rowNode</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;.active&#39;</span><span class="p">),</span>
        <span class="nx">nextRow</span><span class="p">,</span>
        <span class="nx">currentPageNum</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">currentRowNode</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-page&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">),</span>
        <span class="nx">pageLength</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.resourcePages .total&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(),</span> <span class="mi">10</span><span class="p">),</span>
        <span class="nx">diff</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="nx">resources</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">pageNode</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>determine our page direction based on which button was used.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">pageNode</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;prev&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">diff</span> <span class="o">=</span> <span class="s2">&quot;+&quot;</span><span class="p">;</span>
            <span class="nx">nextRow</span> <span class="o">=</span> <span class="nx">currentPageNum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">pageNode</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">diff</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="p">;</span>
            <span class="nx">nextRow</span> <span class="o">=</span> <span class="nx">currentPageNum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>update the available paginators based on where we are.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">nextRow</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">paginator</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;.prev&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">nextRow</span> <span class="o">!==</span> <span class="nx">pageLength</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">paginator</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;.next&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">nextRow</span> <span class="o">===</span> <span class="nx">pageLength</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">paginator</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;.next&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">nextRow</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
             <span class="nx">paginator</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;.prev&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>failsafe - kill the action if going out of bounds.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">nextRow</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">nextRow</span> <span class="o">===</span> <span class="nx">pageLength</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">currentRowNode</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">rowNode</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;[data-page=&quot;&#39;</span><span class="o">+</span><span class="nx">nextRow</span><span class="o">+</span><span class="s1">&#39;&quot;]&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>ajax-call the next set of resources
update width of wrapper - listWidth * row count</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="k">this</span><span class="p">.</span><span class="nx">loadResourceList</span><span class="p">(</span><span class="nx">nextRow</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">rowNode</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;[data-page=&quot;&#39;</span><span class="o">+</span><span class="nx">nextRow</span><span class="o">+</span><span class="s1">&#39;&quot;]&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>

            <span class="nx">wrapperDiv</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span>
                <span class="s2">&quot;marginLeft&quot;</span><span class="o">:</span> <span class="nx">diff</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nx">listWidth</span>
            <span class="p">},</span> <span class="mi">200</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.resourcePages .counter .num&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">nextRow</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>TODO: Add refresh feature to load new images.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadResourceList</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pageNum</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="nx">modalTemplate</span> <span class="o">=</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">templates</span><span class="p">[</span><span class="s1">&#39;resourceList.tmpl&#39;</span><span class="p">],</span>
        <span class="nx">resourceListContainer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.resourceList .wrapper&quot;</span><span class="p">),</span>
        <span class="nx">resourceSettings</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>if we don't have a copy saved in the resources controller object
fetch the page.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">self</span><span class="p">.</span><span class="nx">resources</span><span class="p">[</span><span class="nx">pageNum</span><span class="p">]</span> <span class="o">||</span> <span class="nx">isObjectEmpty</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">resources</span><span class="p">[</span><span class="nx">pageNum</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nx">resourceListContainer</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;row spinner&quot; /&gt;&#39;</span><span class="p">);</span>

        <span class="nx">self</span><span class="p">.</span><span class="nx">getAvailableResources</span><span class="p">(</span><span class="nx">pageNum</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
            <span class="nx">resourceSettings</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">createResourceSettings</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
            <span class="nx">resourceListContainer</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">modalTemplate</span><span class="p">(</span><span class="nx">resourceSettings</span><span class="p">));</span>
            <span class="nx">resourceListContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.spinner&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">resourceSettings</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">createResourceSettings</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">resources</span><span class="p">[</span><span class="nx">pageNum</span><span class="p">]);</span>
        <span class="nx">resourceListContainer</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">modalTemplate</span><span class="p">(</span><span class="nx">resourceSettings</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <h3>GalleryController: showImageModal</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">showImageModal</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">imageNode</span><span class="p">,</span> <span class="nx">option</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">modalTemplate</span><span class="p">,</span> <span class="nx">resourceTemplate</span><span class="p">,</span>
        <span class="nx">imageSettings</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">imageNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">setting</span> <span class="k">in</span> <span class="nx">imageNode</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">imageNode</span><span class="p">[</span><span class="nx">setting</span><span class="p">]</span> <span class="o">!==</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">imageSettings</span><span class="p">[</span><span class="nx">setting</span><span class="p">]</span> <span class="o">=</span> <span class="nx">imageNode</span><span class="p">[</span><span class="nx">setting</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">option</span> <span class="o">===</span> <span class="s2">&quot;delete&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">modalTemplate</span> <span class="o">=</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">templates</span><span class="p">[</span><span class="s1">&#39;deleteImage.tmpl&#39;</span><span class="p">];</span>

        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editModal&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">modalTemplate</span><span class="p">(</span><span class="nx">imageSettings</span><span class="p">));</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">modalTemplate</span> <span class="o">=</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">templates</span><span class="p">[</span><span class="s1">&#39;editImageTemplate.tmpl&#39;</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>after the modal is appended, load the resourceList.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">getAvailableResources</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>update our controller copy while we're at it.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">self</span><span class="p">.</span><span class="nx">resources</span><span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
            <span class="nx">imageSettings</span><span class="p">[</span><span class="s2">&quot;resources&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">createResourceSettings</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">resources</span><span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">]);</span>

            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editModal&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">modalTemplate</span><span class="p">(</span><span class="nx">imageSettings</span><span class="p">));</span>

            <span class="nx">self</span><span class="p">.</span><span class="nx">loadResourceList</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

        <span class="p">});</span>




    <span class="p">}</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editModal&#39;</span><span class="p">).</span><span class="nx">modal</span><span class="p">().</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="s2">&quot;50%&quot;</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">showImageGroupModal</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">groupNode</span><span class="p">,</span> <span class="nx">option</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">modalTemplate</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">option</span> <span class="o">===</span> <span class="s2">&quot;delete&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">modalTemplate</span> <span class="o">=</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">templates</span><span class="p">[</span><span class="s1">&#39;deleteImageGroup.tmpl&#39;</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">modalTemplate</span> <span class="o">=</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">templates</span><span class="p">[</span><span class="s1">&#39;newImageGroup.tmpl&#39;</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editModal&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">modalTemplate</span><span class="p">(</span><span class="nx">groupNode</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editModal&#39;</span><span class="p">).</span><span class="nx">modal</span><span class="p">().</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="s2">&quot;50%&quot;</span><span class="p">);</span>

<span class="p">};</span>

<span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hideModal</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editModal&#39;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">&quot;hide&quot;</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <h3>GalleryController: checkFormSubmit</h3>

<p>Used for creating and editing images and imageGroups.
Checks that the form values are valid, and returns visual errors if they're not.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">checkImageForm</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buttonNode</span><span class="p">,</span> <span class="nx">editMode</span><span class="p">,</span> <span class="nx">formValues</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">alertBox</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editModal&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.alert&#39;</span><span class="p">),</span>
        <span class="nx">imageGroupName</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> 
        <span class="nx">imageSettings</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">createImageJSON</span><span class="p">(</span><span class="nx">formValues</span><span class="p">),</span>
        <span class="nx">imageNode</span><span class="p">,</span> <span class="nx">imageGroup</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>clear any class states previously added to the alertbox.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">alertBox</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;alert-error alert-warning&#39;</span><span class="p">).</span><span class="nx">empty</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>URL should also be hard required.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">imageSettings</span><span class="p">.</span><span class="nx">url</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editModal&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;imageURL&quot;]&#39;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.field&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;control-group error&#39;</span><span class="p">);</span>

        <span class="nx">returnError</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Name is always required, and we won't continue without it.
first check if any name has been entered.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">imageSettings</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editModal&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;imageName&quot;]&#39;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.field&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;control-group error&#39;</span><span class="p">);</span>

        <span class="nx">returnError</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">imageGroupName</span> <span class="o">=</span> <span class="nx">buttonNode</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-groupName&#39;</span><span class="p">);</span>
        <span class="nx">imageGroup</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">getImageGroupByName</span><span class="p">(</span><span class="nx">imageGroupName</span><span class="p">);</span>
        <span class="nx">imageNode</span> <span class="o">=</span> <span class="nx">imageGroup</span><span class="p">.</span><span class="nx">getImageByName</span><span class="p">(</span><span class="nx">imageSettings</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>if this is NOT an edit, and
if imageName is the same as another image in this group,
also throw an error and tell the user about it.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">editMode</span> <span class="o">===</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">imageNode</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editModal&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;imageName&quot;]&#39;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.field&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;control-group error&#39;</span><span class="p">);</span>

            <span class="nx">returnError</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>it's edit mode and we found the image, hooray!</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">editMode</span> <span class="o">===</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">imageNode</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">){</span>       
            <span class="nx">$</span><span class="p">(</span><span class="nx">self</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;hidemodal&#39;</span><span class="p">);</span>
            <span class="nx">imageGroup</span><span class="p">.</span><span class="nx">editImage</span><span class="p">(</span><span class="nx">imageNode</span><span class="p">,</span> <span class="nx">imageSettings</span><span class="p">);</span>

        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>we're in the clear, create a new image!</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">editMode</span> <span class="o">===</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">imageNode</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="nx">self</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;hidemodal&#39;</span><span class="p">);</span>
            <span class="nx">imageGroup</span><span class="p">.</span><span class="nx">createImage</span><span class="p">(</span><span class="nx">imageSettings</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">returnError</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alertBox</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;alert-error&#39;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">IG</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">errorCodes</span><span class="p">.</span><span class="nx">images</span><span class="p">[</span><span class="nx">code</span><span class="p">])</span>
          <span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">};</span>

<span class="p">};</span>

<span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">checkDeleteImage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buttonNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">imageName</span> <span class="o">=</span> <span class="nx">buttonNode</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-imageName&#39;</span><span class="p">),</span>
        <span class="nx">groupName</span> <span class="o">=</span> <span class="nx">buttonNode</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-groupName&#39;</span><span class="p">),</span>
        <span class="nx">groupNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">getImageGroupByName</span><span class="p">(</span><span class="nx">groupName</span><span class="p">),</span>
        <span class="nx">imageNode</span> <span class="o">=</span> <span class="nx">groupNode</span><span class="p">.</span><span class="nx">getImageByName</span><span class="p">(</span><span class="nx">imageName</span><span class="p">);</span>
    
    <span class="k">if</span><span class="p">(</span><span class="nx">groupNode</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">groupNode</span><span class="p">.</span><span class="nx">deleteImage</span><span class="p">(</span><span class="nx">imageNode</span><span class="p">);</span>  
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;hidemodal&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">};</span>

<span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">checkDeleteGroup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">groupName</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">groupNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">getImageGroupByName</span><span class="p">(</span><span class="nx">groupName</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">groupNode</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">deleteImageGroup</span><span class="p">(</span><span class="nx">groupNode</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;hidemodal&#39;</span><span class="p">);</span>

    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">checkEditGroupName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">groupName</span><span class="p">,</span> <span class="nx">newName</span><span class="p">,</span> <span class="nx">buttonNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">groupNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">getImageGroupByName</span><span class="p">(</span><span class="nx">groupName</span><span class="p">),</span>
        <span class="nx">newGroup</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">getImageGroupByName</span><span class="p">(</span><span class="nx">newName</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>clear out any error popovers</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">buttonNode</span><span class="p">.</span><span class="nx">popover</span><span class="p">(</span><span class="s1">&#39;destroy&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">newName</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">showPopover</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">groupName</span> <span class="o">===</span> <span class="nx">newName</span><span class="p">)</span> <span class="p">{</span> </pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>close the input view.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">groupNameEditClose</span><span class="p">(</span><span class="nx">buttonNode</span><span class="p">);</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>That name is already taken by another group.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">newGroup</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>requires bootstrap popover.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">showPopover</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">editImageGroup</span><span class="p">(</span><span class="nx">groupNode</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="nx">newName</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>close the input view.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">groupNameEditClose</span><span class="p">(</span><span class="nx">buttonNode</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">showPopover</span><span class="p">(</span><span class="nx">errorCode</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">buttonNode</span><span class="p">.</span><span class="nx">popover</span><span class="p">({</span>
            <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Oops!&quot;</span><span class="p">,</span>
            <span class="nx">placement</span><span class="o">:</span> <span class="s2">&quot;top&quot;</span><span class="p">,</span>
            <span class="nx">content</span><span class="o">:</span> <span class="nx">IG</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">errorCodes</span><span class="p">.</span><span class="nx">galleries</span><span class="p">[</span><span class="nx">errorCode</span><span class="p">],</span>
            <span class="nx">trigger</span><span class="o">:</span> <span class="s2">&quot;manual&quot;</span>
        <span class="p">}).</span><span class="nx">popover</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">);</span>

    <span class="p">}</span>

<span class="p">};</span>

<span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">groupNameEditClose</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">targetNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">targetNode</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.editGroupName&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">targetNode</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.editGroupName&#39;</span><span class="p">).</span><span class="nx">siblings</span><span class="p">(</span><span class="s1">&#39;.groupName&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">checkImageGroupForm</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buttonNode</span><span class="p">,</span> <span class="nx">formValues</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">alertBox</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editModal&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.alert&#39;</span><span class="p">),</span>
        <span class="nx">nameValue</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">grep</span><span class="p">(</span><span class="nx">formValues</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">val</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;groupName&quot;</span><span class="p">;</span> 
        <span class="p">}),</span>
        <span class="nx">imageGroupName</span> <span class="o">=</span> <span class="nx">nameValue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">,</span>
        <span class="nx">imageGroup</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">getImageGroupByName</span><span class="p">(</span><span class="nx">imageGroupName</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>clear any class states previously added to the alertbox.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">alertBox</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;alert-error alert-warning&#39;</span><span class="p">).</span><span class="nx">empty</span><span class="p">().</span><span class="nx">hide</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Name is always required, and we won't continue without it.
first check if any name has been entered.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">imageGroupName</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editModal&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;groupName&quot;]&#39;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.field&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;control-group error&#39;</span><span class="p">);</span>

        <span class="nx">alertBox</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;alert-error&#39;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">IG</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">errorCodes</span><span class="p">.</span><span class="nx">galleries</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">])</span>
          <span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">imageGroup</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editModal&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;groupName&quot;]&#39;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.field&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;control-group error&#39;</span><span class="p">);</span>

            <span class="nx">alertBox</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;alert-error&#39;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">IG</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">errorCodes</span><span class="p">.</span><span class="nx">galleries</span><span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">])</span>
              <span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>in the clear, make a group!</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">createImageGroup</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="nx">imageGroupName</span><span class="p">});</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;hidemodal&#39;</span><span class="p">);</span>

        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">createImageJSON</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">formValues</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">imageObject</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">formValues</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="s2">&quot;imageName&quot;</span><span class="p">)</span> 
          <span class="nx">imageObject</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="s2">&quot;imageDescr&quot;</span><span class="p">)</span>
          <span class="nx">imageObject</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="s2">&quot;imageURL&quot;</span><span class="p">)</span>
          <span class="nx">imageObject</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">imageObject</span><span class="p">;</span>  
<span class="p">};</span>

<span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">processImageOrder</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">targetObject</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">imageArray</span> <span class="o">=</span> <span class="nx">targetObject</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.images&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.image&#39;</span><span class="p">),</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">max</span> <span class="o">=</span> <span class="nx">imageArray</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">imageName</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="nx">imageNameArray</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">imageGroup</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">getImageGroupByName</span><span class="p">(</span><span class="nx">targetObject</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-groupName&#39;</span><span class="p">));</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">imageName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">imageArray</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">);</span>
            <span class="nx">imageNameArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">imageName</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">imageGroup</span><span class="p">.</span><span class="nx">resortImages</span><span class="p">(</span><span class="nx">imageNameArray</span><span class="p">);</span>
<span class="p">};</span>


<span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toggleShowDetails</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buttonNode</span><span class="p">,</span> <span class="nx">targetDetails</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">groupName</span> <span class="o">=</span> <span class="nx">buttonNode</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.imageGroup&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span>
        <span class="nx">groupNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">getImageGroupByName</span><span class="p">(</span><span class="nx">groupName</span><span class="p">),</span>
        <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">openState</span><span class="p">;</span>

    <span class="nx">targetDetails</span><span class="p">.</span><span class="nx">slideToggle</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">buttonNode</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Hide&quot;</span><span class="p">);</span>
            <span class="nx">openState</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">buttonNode</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Show&quot;</span><span class="p">);</span>
            <span class="nx">openState</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">self</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">editImageGroup</span><span class="p">(</span><span class="nx">groupNode</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;showDetails&quot;</span><span class="o">:</span> <span class="nx">openState</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">};</span>


<span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">triggerGroupSettingChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">groupName</span><span class="p">,</span> <span class="nx">inputNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">groupNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">getImageGroupByName</span><span class="p">(</span><span class="nx">groupName</span><span class="p">),</span>
        <span class="nx">inputValue</span> <span class="o">=</span> <span class="nx">inputNode</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">),</span>
        <span class="nx">isSelected</span> <span class="o">=</span> <span class="nx">inputNode</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">),</span>
        <span class="nx">inputName</span> <span class="o">=</span> <span class="nx">inputNode</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span>
        <span class="nx">settingsObj</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>kill any active popovers.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.setting&#39;</span><span class="p">).</span><span class="nx">popover</span><span class="p">(</span><span class="s2">&quot;destroy&quot;</span><span class="p">);</span>

    <span class="k">switch</span> <span class="p">(</span><span class="nx">inputName</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s2">&quot;groupDescription&quot;</span><span class="o">:</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">editImageGroup</span><span class="p">(</span><span class="nx">groupNode</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="nx">inputValue</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
       <span class="k">case</span> <span class="s2">&quot;thumbSize&quot;</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>check it it's a number, and make sure it has the "px" suffix.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">inputValue</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">inputValue</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">inputValue</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">inputValue</span><span class="p">)</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">inputValue</span> <span class="o">=</span> <span class="nx">inputValue</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
                <span class="nx">settingsObj</span><span class="p">[</span><span class="nx">inputName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">inputValue</span><span class="p">;</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">editImageGroup</span><span class="p">(</span><span class="nx">groupNode</span><span class="p">,</span> <span class="nx">settingsObj</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>not a number, show error.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">showPopover</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="k">case</span> <span class="s2">&quot;showImgNames&quot;</span><span class="o">:</span>
        <span class="k">case</span> <span class="s2">&quot;showGrDescr&quot;</span><span class="o">:</span>
        <span class="k">case</span> <span class="s2">&quot;showImgDescr&quot;</span><span class="o">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">isSelected</span> <span class="o">===</span> <span class="s2">&quot;checked&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">isSelected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">isSelected</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">settingsObj</span><span class="p">[</span><span class="nx">inputName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">isSelected</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">editImageGroup</span><span class="p">(</span><span class="nx">groupNode</span><span class="p">,</span> <span class="nx">settingsObj</span><span class="p">);</span>
       <span class="k">default</span><span class="o">:</span>
          <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>if it's the radio for thumb constraints, treat differently.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">inputName</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;_thumbConstr&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">inputValue</span> <span class="o">===</span> <span class="s2">&quot;wide&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">editImageGroup</span><span class="p">(</span><span class="nx">groupNode</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;constrWidth&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">editImageGroup</span><span class="p">(</span><span class="nx">groupNode</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;constrWidth&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">});</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

   <span class="kd">function</span> <span class="nx">showPopover</span><span class="p">(</span><span class="nx">errorCode</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">inputNode</span><span class="p">.</span><span class="nx">popover</span><span class="p">({</span>
            <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Oops!&quot;</span><span class="p">,</span>
            <span class="nx">placement</span><span class="o">:</span> <span class="s2">&quot;top&quot;</span><span class="p">,</span>
            <span class="nx">content</span><span class="o">:</span> <span class="nx">IG</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">errorCodes</span><span class="p">.</span><span class="nx">galleries</span><span class="p">[</span><span class="nx">errorCode</span><span class="p">],</span>
            <span class="nx">trigger</span><span class="o">:</span> <span class="s2">&quot;manual&quot;</span>
        <span class="p">}).</span><span class="nx">popover</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">);</span>

    <span class="p">};</span>

<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <h3>GalleryController: bindEvents</h3>

<p>Events that only need to be called once.
TODO: Emulate backbone's awesome click event registry</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">GalleryController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bindEvents</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
    <span class="nx">body</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span>
    <span class="nx">imageGalleryWidget</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#imageGalleryWidget&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>IMAGE EVENTS // ---------------------------------------------------</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>new image modal</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">imageGalleryWidget</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.addImage&#39;</span><span class="p">,</span> <span class="s1">&#39;click.addImage&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">groupName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-groupName&#39;</span><span class="p">);</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">showImageModal</span><span class="p">({</span><span class="s1">&#39;groupName&#39;</span><span class="o">:</span> <span class="nx">groupName</span><span class="p">});</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>edit image modal</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">imageGalleryWidget</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.editImage&#39;</span><span class="p">,</span> <span class="s1">&#39;click.editImage&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">imageName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-imageName&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">groupName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-groupName&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">targetImage</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">findImage</span><span class="p">(</span><span class="nx">imageName</span><span class="p">,</span> <span class="nx">groupName</span><span class="p">);</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">showImageModal</span><span class="p">(</span><span class="nx">targetImage</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">imageGalleryWidget</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.deleteImage&#39;</span><span class="p">,</span> <span class="s1">&#39;click.deleteImage&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">imageName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-imageName&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">groupName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-groupName&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">targetImage</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">findImage</span><span class="p">(</span><span class="nx">imageName</span><span class="p">,</span> <span class="nx">groupName</span><span class="p">);</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">showImageModal</span><span class="p">(</span><span class="nx">targetImage</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">);</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>MODAL EVENTS // ---------------------------------------------------</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>empty the modal when it closes.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editModal&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;hidden&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">empty</span><span class="p">().</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.modal-backdrop&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">});</span> 

    <span class="nx">body</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;#editModal .saveImage&#39;</span><span class="p">,</span> <span class="s1">&#39;click.saveImage&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">editMode</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editImageForm&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;edit&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">formValues</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editImageForm&#39;</span><span class="p">).</span><span class="nx">serializeArray</span><span class="p">();</span>

        <span class="nx">self</span><span class="p">.</span><span class="nx">checkImageForm</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="nx">editMode</span><span class="p">,</span> <span class="nx">formValues</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">body</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;#editModal .saveGroup&#39;</span><span class="p">,</span> <span class="s1">&#39;click.saveGroup&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">formValues</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#newGroupForm&#39;</span><span class="p">).</span><span class="nx">serializeArray</span><span class="p">();</span>

        <span class="nx">self</span><span class="p">.</span><span class="nx">checkImageGroupForm</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="nx">formValues</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">body</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;#editModal .confirmDeleteImage&#39;</span><span class="p">,</span> <span class="s1">&#39;click.confirmDel&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">checkDeleteImage</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>    
    <span class="p">});</span>

    <span class="nx">body</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;#editModal .confirmDeleteGroup&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">groupName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-groupName&#39;</span><span class="p">);</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">checkDeleteGroup</span><span class="p">(</span><span class="nx">groupName</span><span class="p">);</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>MODAL: RESOURCE SELECTOR EVENTS // --------------------------------------</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">body</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;#resourceManager .paginator&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">resourcePagination</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">});</span>

    <span class="nx">body</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;#resourceManager .resource&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">imageUrl</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-url&#39;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.modal&quot;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.form input[name=&quot;imageURL&quot;]&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">imageUrl</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.modal&quot;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.form input[name=&quot;imageName&quot;]&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">text</span><span class="p">());</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">siblings</span><span class="p">(</span><span class="s1">&#39;.resource&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">);</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>IMAGE GROUP EVENTS // ---------------------------------------------------</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>Show/Hide Toggle for the Image Group Details</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">imageGalleryWidget</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.groupDetailsToggle&#39;</span><span class="p">,</span> <span class="s1">&#39;click.toggle&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">targetDetails</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.imageGroup&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.groupDetails&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">buttonNode</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>

        <span class="nx">self</span><span class="p">.</span><span class="nx">toggleShowDetails</span><span class="p">(</span><span class="nx">buttonNode</span><span class="p">,</span> <span class="nx">targetDetails</span><span class="p">);</span>

    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>Edit Group Name Link/Input</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">imageGalleryWidget</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.editGroupTitle&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">groupName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-groupname&#39;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.groupName&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.editGroupName&#39;</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;[data-groupname=&quot;&#39;</span><span class="o">+</span><span class="nx">groupName</span><span class="o">+</span><span class="s1">&#39;&quot;]&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">imageGalleryWidget</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.groupNameCancel&#39;</span><span class="p">,</span> <span class="s1">&#39;click.groupNameCancel&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">groupNameEditClose</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>hides the popover on group title input focus.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">imageGalleryWidget</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.groupNameInput&#39;</span><span class="p">,</span> <span class="s1">&#39;focus&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.groupNameSave, .groupNameInput&#39;</span><span class="p">).</span><span class="nx">popover</span><span class="p">(</span><span class="s1">&#39;destroy&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">imageGalleryWidget</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.groupNameSave&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">groupName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.editGroupName&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-groupname&#39;</span><span class="p">),</span>
            <span class="nx">newName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">siblings</span><span class="p">(</span><span class="s1">&#39;.groupNameInput&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>

            <span class="nx">self</span><span class="p">.</span><span class="nx">checkEditGroupName</span><span class="p">(</span><span class="nx">groupName</span><span class="p">,</span> <span class="nx">newName</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">});</span>

    <span class="nx">imageGalleryWidget</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.deleteGroup&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">groupName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-groupName&#39;</span><span class="p">);</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">showImageGroupModal</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">getImageGroupByName</span><span class="p">(</span><span class="nx">groupName</span><span class="p">),</span> <span class="s2">&quot;delete&quot;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">imageGalleryWidget</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.groupDetails .setting&#39;</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">groupName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.imageGroup&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

        <span class="nx">self</span><span class="p">.</span><span class="nx">triggerGroupSettingChange</span><span class="p">(</span><span class="nx">groupName</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>new image group modal - showImageGroupModal</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">imageGalleryWidget</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.newGroup&#39;</span><span class="p">,</span> <span class="s1">&#39;click.newGroup&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">showImageGroupModal</span><span class="p">();</span>
    <span class="p">});</span>

<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <h1>VIEWS</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">IG</span><span class="p">.</span><span class="nx">ImageGroupView</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">settings</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">templates</span><span class="p">[</span><span class="s1">&#39;imageGroupTemplate.tmpl&#39;</span><span class="p">];</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">imageGroup</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">imageGroup</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">IG</span><span class="p">.</span><span class="nx">ImageView</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">settings</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">templates</span><span class="p">[</span><span class="s1">&#39;imageTemplate.tmpl&#39;</span><span class="p">];</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">image</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">image</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 